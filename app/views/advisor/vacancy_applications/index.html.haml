%section

  %br
  .head.level
    .level-left
      %h2="Vacancy applications awaiting review"
      %span.client_total#filtered_count
        %span.bold=pluralize(@vacancy_applications_awaiting_review.count, 'awaiting application')

  - if @vacancy_applications.count > 0
    - if @vacancy_applications_awaiting_review.count > 0
      %table.table
        %thead
          %tr
            %th
              Name
            %th
              Applied
            %th
              Email
            %th
              Phone
            %th
              Vacancy

        - @vacancy_applications_awaiting_review.each do |vacancy_application|
          - possible_client = Client.with_email(vacancy_application.email).first
          %tr
            %td
              - if possible_client
                = link_to "#{vacancy_application.first_name} #{vacancy_application.last_name}", advisor_client_path(possible_client)
              - else
                = "#{vacancy_application.first_name} #{vacancy_application.last_name}"
            %td
              = vacancy_application.created_at.strftime("%e %B %Y")
            %td
              - if possible_client
                = link_to vacancy_application.email, advisor_client_path(possible_client)
              - else
                = vacancy_application.email
            %td
              = vacancy_application.phone_number
            - if vacancy(@vacancies, vacancy_application.vacancy_id).present?
              %td
                = vacancy(@vacancies, vacancy_application.vacancy_id)["title"]["rendered"]
            - else
              %td
                %small Not found
            %td
              = link_to "Review application", advisor_vacancy_application_path(vacancy_application), class: 'button is-primary is-small'


    - if @vacancy_applications_reviewed.count > 0
      .head.level
        .level-left
          %h2="Reviewed applications"
          %span.client_total#filtered_count
            %span.bold=pluralize(@vacancy_applications_reviewed.count, 'reviewed application')
      %table.table
        %thead
          %tr
            %th
              Name
            %th
              Applied
            %th
              Email
            %th
              Phone
            %th
              Course
            %th
              Intake
            %th

        - @vacancy_applications_reviewed.each do |vacancy_application|
          %tr{ class: "unsuccessful" }
            %td
              = "#{vacancy_application.first_name} #{vacancy_application.last_name}"
            %td
              = vacancy_application.created_at.strftime("%e %B %Y")
            %td
              = vacancy_application.email
            %td
              = vacancy_application.phone_number
            - if vacancy(@vacancies, vacancy_application.vacancy_id).present?
              %td
                = vacancy(@vacancies, vacancy_application.vacancy_id)["title"]["rendered"]
            - else
              %td
                %small Not found
            %td
              = link_to "Review application", advisor_vacancy_application_path(vacancy_application), class: 'button is-primary is-small'
  - else
    %br
    %p="No applications have been made yet"
