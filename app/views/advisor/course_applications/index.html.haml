%section
  .head.level
    .level-left
      %h2="Course Applications"
      %span.client_total#filtered_count
        %span.bold=pluralize(@course_applications.count, ' application')

  .filters
    = form_with url: advisor_course_applications_path, method: :get, skip_enforcing_utf8: true do
      =# label_tag "Filter by course intake: "
      %span.select
        = select_tag "course_intake_select", grouped_options_for_select(@intakes.map{ |intake| [intake["acf"]["parent_course"]["post_title"], [["#{intake["acf"]["start_date"].to_date.strftime("%b %Y")} - #{intake["acf"]["end_date"].to_date.strftime("%b %Y")}", intake["id"]]]] }), onchange: 'this.form.submit();', include_blank: "--Filter by intake--"

  - if @course_applications.count > 0
    %table.table
      %thead
        %tr
          %th
            Name
          %th
            Applied
          %th
            Email
          %th
            Phone
          %th
            Course

      - @course_applications.each do |course_application|
        %tr
          %td
            = "#{course_application.first_name} #{course_application.last_name}"
          %td
            = course_application.created_at.strftime("%e %B %Y")
          %td
            = course_application.email
          %td
            = course_application.phone_number
          %td
            =# link_to course_application.intake_id, advisor_course_application_path(course_application)
            = link_to (@intakes.select{ |intake| intake["id"] == course_application.intake_id })[0]["acf"]["parent_course"]["post_title"], advisor_course_application_path(course_application)
  - else
    %br
    %p="No applications have been made yet"
